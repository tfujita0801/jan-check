
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>JANコード照合（スキャナ用）</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    #results { margin: 1em auto; width: 80%; max-width: 400px; }
    .code-box { font-size: 1.5em; margin: 0.5em; padding: 0.5em; border: 1px solid #ccc; }
    .match { background: #c8f7c5; }
    .mismatch { background: #f7c5c5; }
  </style>
</head>
<body>
  <h1>JANコード照合（スキャナ用）</h1>
  <div id="results">
    <div id="code1" class="code-box">1個目: </div>
    <div id="code2" class="code-box">2個目: </div>
    <div id="result" class="code-box"></div>
  </div>
  <script>
    let step = 1;
    let code1 = "", code2 = "";
    const code1Box = document.getElementById("code1");
    const code2Box = document.getElementById("code2");
    const resultBox = document.getElementById("result");
    const beep = new Audio("beep.mp3");
    const match = new Audio("match.mp3");
    const mismatch = new Audio("mismatch.mp3");

    document.addEventListener("keydown", async (e) => {
      if (e.key === "Shift" || e.key === "Enter") return;
      if (!window._buffer) window._buffer = "";
      window._buffer += e.key;

      if (window._timeout) clearTimeout(window._timeout);
      window._timeout = setTimeout(() => {
        const scanned = window._buffer.trim();
        window._buffer = "";
        if (scanned.length < 6) return;
        if (step === 1) {
          code1 = scanned;
          code1Box.textContent = "1個目: " + code1;
          beep.play();
          step = 2;
        } else {
          code2 = scanned;
          code2Box.textContent = "2個目: " + code2;
          const isMatch = code1 === code2;
          resultBox.textContent = isMatch ? "一致しました" : "不一致です";
          resultBox.className = "code-box " + (isMatch ? "match" : "mismatch");
          (isMatch ? match : mismatch).play();
          step = 1;
          code1 = code2 = "";
          setTimeout(() => {
            code1Box.textContent = "1個目: ";
            code2Box.textContent = "2個目: ";
            resultBox.textContent = "";
            resultBox.className = "code-box";
          }, 2000);
        }
      }, 300);
    });
  </script>
</body>
</html>
